<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HlavnÃ­ nÃ¡draÅ¾Ã­ - JÃ­zdnÃ­ Å™Ã¡d s vyhÄ¾adÃ¡vanÃ­m</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="container">
  <div class="stops">
    <h2>Trasa linky 10</h2>
    <input id="search" placeholder="VyhÄ¾adaÅ¥ zastÃ¡vku..." />
    <ul class="stop-list" id="stopList"></ul>
  </div>

  <div class="schedule">
    <h1 id="scheduleTitle">Odchody - HlavnÃ­ nÃ¡draÅ¾Ã­</h1>
    <table>
      <thead>
        <tr>
          <th>Hodina</th>
          <th>PracovnÃ© dni<br><small>Å¡kolskÃ½ rok</small></th>
          <th>PracovnÃ© dni<br><small>prÃ¡zdniny</small></th>
          <th>VoÄ¾nÃ© dni</th>
        </tr>
      </thead>
      <tbody id="scheduleBody"></tbody>
    </table>
    <div class="note"><strong>T</strong> Zo zastÃ¡vky <strong>Erbenova</strong> pokraÄuje cez OrliÄky, stÅ™ed na koneÄnÃº OrliÄky, toÄna.</div>
    <a href="/index.html" class="back">â† SpÃ¤Å¥ na zoznam zastÃ¡vok</a>
  </div>
</div>

<script>
const stopsData = [
  { name: "HlavnÃ­ nÃ¡draÅ¾Ã­" },
  { name: "PolnÃ­" },
  { name: "ZÅ  RadoÅ¡ovickÃ¡" },
  { name: "ÄŒepkov" },
  { name: "Albert HM" },
  { name: "Poliklinika - mÄ›sto" },
  { name: "Erbenova" },
  { name: "Erbenova, sÃ­dliÅ¡tÄ›" },
  { name: "OrliÄky, stÅ™ed" },
  { name: "OrliÄky, toÄna" }
];

const travelTimes = [1, 1, 1, 2, 1, 1, 0, 2, 1];

const departures = {
  "17": { schoolDays: [56], holidays: [56], freeDays: [56] },
  "18": { schoolDays: [3,18,26,"56T"], holidays: [3,18,26,"56T"], freeDays: [3,18,26,"56T"] },
  "19": { schoolDays: [6,26,46,"33T"], holidays: [6,26,46,"33T"], freeDays: [6,26,46,"33T"] },
  "20": { schoolDays: [6,20,"33T",40,50], holidays: [6,20,"33T",40,50], freeDays: [6,20,"33T",40,50] },
};


function fillScheduleTable(selectedStop) {
  const tbody = document.getElementById("scheduleBody");
  tbody.innerHTML = "";

  const stopIndex = stopsData.findIndex(s => s.name === selectedStop);
  if (stopIndex === -1) return;

  const erbenovaIndex = stopsData.findIndex(s => s.name === "Erbenova");
  const orlickyIndex = stopsData.findIndex(s => s.name === "OrliÄky, toÄna");
  const ctpIndex = stopsData.findIndex(s => s.name === "CTPark StranÄice");
  const cepkovIndex = stopsData.findIndex(s => s.name === "ÄŒepkov");

  let offset = 0;
  for (let i = 0; i < stopIndex; i++) {
    offset += travelTimes[i];
  }

  const adjustedDepartures = {};

  for (let hour in departures) {
    ["schoolDays", "holidays", "freeDays"].forEach(type => {
      departures[hour][type].forEach(min => {
        let baseMinute;
        let suffix = "";

        if (typeof min === "string") {
          const match = min.match(/^(\d+)(\D*)$/);
          if (match) {
            baseMinute = parseInt(match[1], 10);
            suffix = match[2];
          } else {
            baseMinute = parseInt(min, 10);
          }
        } else {
          baseMinute = min;
        }

        const isT = suffix.includes("T");

        // ğŸ‘‰ Filtrovanie podÄ¾a zastÃ¡vky a prÃ­pony "T"
        if (stopIndex >= erbenovaIndex) {
          if (!isT) return; // spoje bez "T" konÄia pred Erbenovou
        }

        let timeOffset = offset;

        // PrÃ­klad s C-spojmi
        const isC = suffix.includes("C");
        if (isC) {
          if (stopIndex > cepkovIndex) timeOffset += 1;
          if (stopIndex > ctpIndex) timeOffset += 3;
        }

        const totalMinutes = parseInt(hour) * 60 + baseMinute + timeOffset;
        const h = Math.floor(totalMinutes / 60);
        const m = totalMinutes % 60;
        const hStr = h.toString();

        if (!adjustedDepartures[hStr]) {
          adjustedDepartures[hStr] = {
            schoolDays: [],
            holidays: [],
            freeDays: []
          };
        }

        adjustedDepartures[hStr][type].push({ minute: m, suffix });
      });
    });
  }

  const sortedHours = Object.keys(adjustedDepartures).sort((a, b) => a - b);

  for (let hour of sortedHours) {
    const row = document.createElement("tr");
    const th = document.createElement("td");
    th.classList.add("hour");
    th.textContent = hour;
    row.appendChild(th);

    ["schoolDays", "holidays", "freeDays"].forEach(type => {
      const td = document.createElement("td");
      const minutes = adjustedDepartures[hour][type]
        .sort((a, b) => a.minute - b.minute)
        .map(({ minute, suffix }) => {
          return minute.toString().padStart(2, "0") + suffix;
        });

      td.textContent = minutes.join(" ");
      row.appendChild(td);
    });
    
    
    tbody.appendChild(row);
  }

  // PoznÃ¡mka o T spojoch len pre zastÃ¡vky Erbenova a OrliÄky
  const noteC = document.querySelector(".note");
  const isTStop = stopIndex >= erbenovaIndex;
  noteC.style.display = isTStop ? "block" : "block";
}


function fillStopListWithTimes() {
  const ul = document.getElementById("stopList");
  ul.innerHTML = "";

  let cumulatedTime = 0;

  const startIndex = stopsData.findIndex(s => s.name === "Erbenova");
  const endIndex = stopsData.findIndex(s => s.name === "OrliÄky, toÄna");

  stopsData.forEach((stop, i) => {
    const li = document.createElement("li");

    // Zisti, Äi je tÃ¡to zastÃ¡vka medzi Erbenova a OrliÄky, toÄna (vrÃ¡tane)
    const isIndented = i >= startIndex && i <= endIndex;

    li.innerHTML = `â€ ${stop.name} <span class="stop-time">${cumulatedTime} min â€</span>`;

    // Ak Ã¡no, posuÅˆ ju o 20px doÄ¾ava
    if (isIndented) {
      li.style.paddingLeft = "20px";
    }

    li.addEventListener("click", () => {
      document.getElementById("scheduleTitle").textContent = `Odchody - ${stop.name}`;
      fillScheduleTable(stop.name);

      ul.querySelectorAll("li").forEach(el => el.classList.remove("active"));
      li.classList.add("active");
    });

    ul.appendChild(li);

    if (i < travelTimes.length) {
      cumulatedTime += travelTimes[i];
    }
  });

  // OznaÄ prvÃº aktÃ­vnu zastÃ¡vku
  const firstLi = ul.querySelector("li");
  if (firstLi) {
    firstLi.classList.add("active");
    fillScheduleTable(stopsData[0].name);
  }
}


function setupSearch() {
  const searchInput = document.getElementById("search");
  const ul = document.getElementById("stopList");

  searchInput.addEventListener("input", () => {
    const query = searchInput.value.toLowerCase().trim();
    const lis = ul.querySelectorAll("li");

    lis.forEach(li => {
      const stopName = li.textContent.toLowerCase();
      li.style.display = stopName.includes(query) ? "" : "none";
    });
  });
}

window.onload = () => {
  fillStopListWithTimes();
  setupSearch();
};
</script>

</body>
</html>
