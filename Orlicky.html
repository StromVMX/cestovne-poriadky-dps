<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Linka 37 - CTPark Stranƒçice - J√≠zdn√≠ ≈ô√°d</title>
  <link rel="stylesheet" href="style37.css" />
</head>
<body>
  <div class="container">
    <div class="stop-column">
      <input type="text" id="searchInput" placeholder="Vyhƒæada≈• zast√°vku..." aria-label="Vyhƒæada≈• zast√°vku" />
      <ul id="stopList" role="listbox" aria-label="Zoznam zast√°vok"></ul>
    </div>
    <div class="timetable-column">
      <h2 id="stopHeading">Odchody</h2>
      <table aria-label="Tabuƒæka odchodov">
        <thead>
          <tr>
            <th>Hodina</th>
            <th>Min√∫ty</th>
          </tr>
        </thead>
        <tbody id="timetableBody"></tbody>
      </table>

      <div id="nextDepartureBox" class="next-departure" style="display: none;"></div>

      <div class="note" style="margin-top: 15px; background: #d7e4f2; padding: 10px 14px; border-radius: 8px; font-size: 0.9rem; color: #154a86;">
        <strong>D</strong> Zo zast√°vky <strong>Hlavn√≠ n√°dra≈æ√≠</strong> pokraƒçuje cez <strong>Okrajov√°</strong> na koneƒçn√∫ <strong>Dopravn√≠ podnik</strong>.
      </div>
      <div class="note" style="margin-top: 15px; background: #d7e4f2; padding: 10px 14px; border-radius: 8px; font-size: 0.9rem; color: #154a86;">
        <strong>C</strong> Zach√°dza na zast√°vku <strong>CTPark</strong>.
      </div>
      <div class="note" style="margin-top: 15px; background: #d7e4f2; padding: 10px 14px; border-radius: 8px; font-size: 0.9rem; color: #154a86;">
        <strong>E</strong> Zo zast√°vky <strong>Evropsk√°-rondel</strong> pokraƒçuje cez <strong>Okrajov√°</strong> na koneƒçn√∫ <strong>Dopravn√≠ podnik</strong>.
      </div>

      <a href="/index.html" class="back">‚Üê Sp√§≈• na zoznam zast√°vok</a>
    </div>

    <script>
      const stops = [
        { name: "Orliƒçky, toƒçna", zone: "100", minutesFromStart: 0, Train: false, Barier: false, Automat: true, Znamenie: false, Special: false },
        { name: "Orliƒçky, st≈ôed", zone: "100", minutesFromStart: 1, Train: false, Barier: false, Automat: false, Znamenie: true, Special: false },
        { name: "Dru≈æstevn√≠", zone: "100", minutesFromStart: 2, Train: false, Barier: false, Automat: false, Znamenie: false, Special: false },
        { name: "Evropsk√°-rondel", zone: "100", minutesFromStart: 4, Train: false, Barier: false, Automat: true, Znamenie: false, Special: false },
        { name: "Dopravn√≠ podnik", zone: "100", minutesFromStart: 0, onlyForNote: "D", indent: true, Train: false, Barier: false, Automat: true, Znamenie: false, Special: true },
        { name: "Okrajov√°", zone: "100", minutesFromStart: 5, onlyForNote: "D", indent: true, Train: false, Barier: false, Automat: true, Znamenie: false, Special: true },
        { name: "Hlavn√≠ n√°dra≈æ√≠", zone: "100", minutesFromStart: 6, Train: true, Barier: true, Automat: true, Znamenie: false, Special: false },
        { name: "Poln√≠", zone: "100", minutesFromStart: 8, onlyForNote: "C", indent: false, Train: false, Barier: true, Automat: false, Znamenie: false, Special: false },
        { name: "Z≈† Rado≈°ovick√°", zone: "100", minutesFromStart: 9, onlyForNote: "C", indent: false, Train: false, Barier: true, Automat: true, Znamenie: false, Special: false },
        { name: "ƒåepkov", zone: "100", minutesFromStart: 10, onlyForNote: "C", indent: false, Train: false, Barier: false, Automat: false, Znamenie: true, Special: false },
        { name: "CTPark Stranƒçice", zone: "100", minutesFromStart: 13, onlyForNote: "C", indent: false, Train: false, Barier: false, Automat: false, Znamenie: false, Special: false },
      ];
      

      const timetable = {
        17: [{ min: 58, note: "CD" }],
        18: [{ min: 33, note: "C" }, { min: 58, note: "CD" }],
        19: [{ min: 22, note: "C" }],
        20: [{ min: 33, note: "C" }],
        21: [{ min: 3, note: "E" }]
      };

      const stopList = document.getElementById("stopList");
      const timetableBody = document.getElementById("timetableBody");
      const searchInput = document.getElementById("searchInput");
      const stopHeading = document.getElementById("stopHeading");
      const nextDepartureBox = document.getElementById("nextDepartureBox");

      function renderStops(filteredStops) {
        stopList.innerHTML = "";
        filteredStops.forEach((stop, i) => {
          const li = document.createElement("li");
          li.setAttribute('role', 'option');
          li.setAttribute('tabindex', '0');
          li.setAttribute('data-index', i);
          li.setAttribute('aria-selected', 'false');

          // Ikony podƒæa vlastnost√≠
          const icons = [];
          if (stop.Train) icons.push('<img src="icons/Train.png" alt="Vlak" title="Vlak" class="icon">');
          if (stop.Barier) icons.push('<img src="icons/Barier.png" alt="Z√°vory" title="Z√°vory" class="icon">');
          if (stop.Automat) icons.push('<img src="icons/Automat.png" alt="Automat" title="Automat na l√≠stky" class="icon">');
          if (stop.Znamenie) icons.push('<img src="icons/Znamenie.png" alt="Znamenie" title="Zast√°vka na znamenie" class="icon">');
          if (stop.Special) icons.push('<img src="icons/Special.png" alt="Special" title="Obƒçasn√° zast√°vka" class="icon">');

          li.innerHTML = `
            <span class="${stop.indent ? 'indent' : ''}">
              ${stop.name} ${icons.join('')}
            </span>
          <span class="zone">${stop.minutesFromStart} min</span>
          `;

          li.addEventListener("click", () => setSelectedStop(li));
          li.addEventListener("keydown", e => {
            if (e.key === "Enter" || e.key === " ") {
              setSelectedStop(li);
              e.preventDefault();
            } else if (e.key === "ArrowDown") {
              e.preventDefault();
              if (li.nextElementSibling) li.nextElementSibling.focus();
            } else if (e.key === "ArrowUp") {
            e.preventDefault();
            if (li.previousElementSibling) li.previousElementSibling.focus();
            }
          });

          stopList.appendChild(li);
        });

        if (!document.querySelector("#stopList li.selected") && filteredStops.length > 0) {
          setSelectedStop(stopList.firstChild);
        }
      }

      function setSelectedStop(li) {
        const prev = stopList.querySelector("li.selected");
        if (prev) {
          prev.classList.remove("selected");
          prev.setAttribute("aria-selected", "false");
        }
        li.classList.add("selected");
        li.setAttribute("aria-selected", "true");
        li.focus();
        const idx = +li.getAttribute("data-index");
        renderTimetable(idx);
        stopHeading.textContent = `Odchody - ${stops[idx].name}`;
      }

      function renderTimetable(stopIndex) {
        const stop = stops[stopIndex];
        const now = new Date();
        const currentTotal = now.getHours() * 60 + now.getMinutes();
        timetableBody.innerHTML = "";
        const groups = {};

        Object.entries(timetable).forEach(([hourStr, entries]) => {
  const hour = parseInt(hourStr);
  entries.forEach(({ min, note }) => {
    let offset = stop.minutesFromStart;

    if (stop.onlyForNote && (!note || !note.includes(stop.onlyForNote))) return;
    if (stop.name === "CTPark Stranƒçice" && (!note || !note.includes("C") && !note.includes("S"))) return;

    // üí° NOV√Å LOGIKA PRE D SPOJE
    if (note?.includes("D")) {
  const dpIndex = stops.findIndex(s => s.name === "Dopravn√≠ podnik");
  const hnIndex = stops.findIndex(s => s.name === "Hlavn√≠ n√°dra≈æ√≠");
  const ctparkIndex = stops.findIndex(s => s.name === "CTPark Stranƒçice");

  const endsAt = note.includes("C") ? ctparkIndex : hnIndex;

  if (stopIndex < dpIndex || stopIndex > endsAt) return;
}

    // ‚õî Skry≈• E spoje za Evropsk√°-rondel
    if (note?.includes("E")) {
      const evIndex = stops.findIndex(s => s.name === "Evropsk√°-rondel");
      if (stopIndex > evIndex) return;
    }

    const totalMin = hour * 60 + min + offset;
    const h = Math.floor(totalMin / 60);
    const m = totalMin % 60;
    if (!groups[h]) groups[h] = [];
    groups[h].push({ min: m, note });
  });
});



        let next = null;
        outer:
        for (let h = now.getHours(); h <= 23; h++) {
          if (!groups[h]) continue;
          const mins = groups[h].map(x => x.min).sort((a, b) => a - b);
          for (const mm of mins) {
            if (h * 60 + mm >= currentTotal) {
              next = { hour: h, minute: mm };
              break outer;
            }
          }
        }

        Object.keys(groups).map(Number).sort((a, b) => a - b).forEach(h => {
          const cells = groups[h]
            .sort((a, b) => a.min - b.min)
            .map(({ min, note }) => {
              const isNext = next && next.hour === h && next.minute === min;
              const cls = isNext ? 'minute-box next-minute-highlight' : 'minute-box';
              return `<span class="${cls}">${String(min).padStart(2, '0')}${
                note ? `<span class="note">${note}</span>` : ''
              }</span>`;
            }).join("");
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${h}</td><td>${cells}</td>`;
          timetableBody.appendChild(tr);
        });

        if (next) {
          nextDepartureBox.style.display = 'block';
          nextDepartureBox.textContent =
            `Najbli≈æ≈°√≠ odchod: ${String(next.hour).padStart(2, '0')}:${String(next.minute).padStart(2, '0')}`;
        } else {
          nextDepartureBox.style.display = 'none';
        }
      }

      searchInput.addEventListener("input", () => {
        const q = searchInput.value.trim().toLowerCase();
        const filtered = q
          ? stops.filter(s => s.name.toLowerCase().includes(q))
          : stops;
        renderStops(filtered.length ? filtered : stops);
      });

      renderStops(stops);
    </script>
  </div>
</body>
</html>
